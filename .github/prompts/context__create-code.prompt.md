---
agent: 'agent'
description: 'コンテキストファイルを作成'
---

# コード実装用コンテキスト生成

---

## 概要
コード実装用のコンテキストエンジニアリング・コンテキスト生成を行う。

---

## Task
1. 要求事項の確認
2. 必要事項を収集
3. コンテキストファイルへの書き出し
4. コンテキストレビューと修正

---

## Phase 1. 要求事項の確認

ユーザへの要求事項を、暗黙的な条件も含めて確認を行う：

```markdown
## 📝 ユーザの要求事項の確認

\```
ユーザの要求事項：ログイン機能の実装
  - **ログイン方式**: ユーザ名、パスワード
  - **パスワード保存方式**: SHA256
\```

この内容でよろしいですか？ (y/n)
修正が必要な場合は修正内容をお知らせください。
```

**ユーザの承認（y）が得られた場合のみ次フェーズへ進む。**

---

## Phase 2. 必要事項を収集

ユーザの要求事項に必要となるファイル・情報を**エージェントを使用して並列に**収集する。

### 使用エージェント

| エージェント | 用途 | 使用タイミング |
|------------|------|--------------|
| **document-explorer** | ドキュメントファイルの取得及び要約 | docs/ 配下の仕様書参照時 |
| **code-explorer** | コードのread、要約、レビュー | 既存コードの理解が必要な時 |
| **note-explorer** | docs/note/ 配下の情報検索 | 過去の議論や技術メモ参照時 |

### 収集する情報

1. **既存実装の確認** (code-explorer)
   - 類似機能の実装方法
   - 使用している技術スタック
   - コーディング規約の実例

2. **仕様書の参照** (document-explorer)
   - 要件定義書 (docs/requirements.md)
   - 設計書 (docs/design.md)
   - IF仕様書 (docs/ifspec.yaml)

3. **過去の議論** (note-explorer)
   - 関連する技術的決定
   - 既知の制約事項

---

## Phase 3. コンテキストファイルへの書き出し

## 出力
作成したコンテキストを、`.context/YYYYMMDDhhmmss.md` の形式で保存。

**命名例**:
- `20251207143000.md` (2025年12月7日 14:30:00)
- `20251225090000.md` (2025年12月25日 09:00:00)

### 出力例
```markdown
# ログイン処理実装コンテキスト

## 📝 概要
ログイン処理の実装を行う。

## 🎯 実装目的
- ユーザ認証機能の提供
- セキュアなパスワード管理の実現

## 📚 用語説明
- **SHA256**: 暗号学的ハッシュ関数の一種。256ビットのハッシュ値を生成
- **ハッシュ化**: 平文をハッシュ関数で不可逆変換する処理

## 🏗️ 実装方針
- **開発手法**: TDDによる実装
- **実装優先度**: 高
- **外部依存**: なし

## 📁 対象ファイル

### 新規作成
- `src/main/Login.py` - ログイン処理のメインロジック
- `src/test/LoginTest.py` - ログイン処理の単体テスト

### 修正
- `src/main/Pattern.py` - バリデーションパターンの追加
- `src/test/PatternTest.py` - バリデーションパターンのテスト追加

## ✅ テストケース (TDD REDフェーズ)

### ファイル名: `src/test/LoginTest.py`

#### 1. ログインが成功すること
- **given**: username=`username`, password=`password`
- **when**: Login.login(username, password)
- **then**: ログイン成功、200が返ってくる

#### 2. ユーザ名バリデーションエラー
- **given**: username=`username`, password=`p`
- **when**: Login.login(username, password)
- **then**: バリデーションエラー、403が返ってくる

## 🤖 使用するエージェント
1. **tdd-red-agent**: TDD REDフェーズで使用するエージェント
2. **tdd-green-agent**: TDD GREENフェーズで使用するエージェント

## 📏 コーディング規約

### 実装コード
- 1行は120文字以内に収めること
- 関数名はスネークケース、変数名はキャメルケース

### テストコード
- 文字数に関係あるものは`"a".repeat(150)`のように表記すること
- given-when-thenで実装すること

## ✅ 終了条件
- [ ] ログインの実装が完了していること
- [ ] 全テストケースがパスしていること
- [ ] コンパイルが正常に終了すること

## 📖 参考ドキュメント
- `docs/requirements.md` - 要件定義書
- `docs/design.md` - 設計書

## ⚠️ 制約事項・注意点
- パスワードは必ずハッシュ化して保存すること
- 平文パスワードをログに出力しないこと

## ❓ ユーザへの確認事項
（必要に応じて記載）
```

---

## Phase 4. コンテキストレビュー及び修正

**context-review** エージェントを起動し、コンテキストのレビューを行う。

### レビュー手順

1. **レビュー起動**:
   - Task tool を使用して context-review エージェントを起動
   - 作成したコンテキストファイルのパスを指定

2. **レビュー観点**:
   - ✅ 要件の網羅性（必要な情報が全て含まれているか）
   - ✅ 記述の具体性（曖昧な表現がないか）
   - ✅ 参照ドキュメントの妥当性と存在確認
   - ✅ テストケースの十分性
   - ✅ 終了条件の明確性
   - ✅ コード例が含まれていないか

3. **修正反映**:
   - レビュー結果に基づいてコンテキストファイルを修正
   - 必要に応じてユーザに確認を取る

4. **完了確認**:
   コンテキストファイルが以下の基準を満たすことを確認：
   - [ ] 曖昧な表現が除去されている
   - [ ] 実装コード例が含まれていない
   - [ ] 必須セクションが全て記載されている
   - [ ] 参照ドキュメントが実際に存在する
   - [ ] 終了条件が明確で測定可能

---

## 注意事項

### エージェントの使用 【MUST】

ドキュメントやコードの確認においては**必ず**エージェントを使用する：
  - **document-explorer**: docs/ 配下のドキュメント参照
  - **code-explorer**: ソースコードの理解
  - **note-explorer**: docs/note/ 配下の情報検索

### コンテキスト品質 【MUST】
- **必要最低限のみ記載**: 目的に直接関係する情報のみ
- **コードを載せない**: 実装例ではなく、要件・方針を記載
- **曖昧さの排除**: 「できれば」「なるべく」等の表現禁止
- **具体的な数値**: 「適切な」ではなく「120文字以内」のように明示

### ファイル命名 【MUST】
- フォーマット: `.context/YYYYMMDDhhmmss.md`
- タイムスタンプは作成時刻を使用

### レビュー必須 【MUST】
- Phase 4 のコンテキストレビューは省略不可
- ユーザの最終承認を必ず取得

