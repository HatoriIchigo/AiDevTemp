---
agent: 'agent'
description: '指定されたコンテキストからコードレビューを実行する。'
---

# Code Reviewer Command

## 概要
コードの総合的なレビューを行うカスタムスラッシュコマンド。複数の専門エージェントを使用してコードを多角的に分析し、優先順位付きの改善提案を提供します。

## 使用方法

```
/code-reviewer [対象ファイル/ディレクトリ]
```

例：
```
/code-reviewer src/
/code-reviewer src/components/UserAuth.tsx
/code-reviewer
```

## Task
1. 多角的レビューの実行
2. 結果の統合と優先順位付け
3. レビュー結果出力

## 実行内容

### 1. 多角的レビューの実行
以下の専門エージェントを並列で実行してコードレビューを行います：

- **code-design-reviewer**: コードの品質、美しさ、設計の一貫性をレビュー
- **performance-reviewer**: 性能要件とパフォーマンスの最適化をレビュー
- **security-reviewer**: セキュリティ脆弱性と安全性をレビュー

### 2. 結果の統合と優先順位付け
各エージェントの結果を統合し、以下の基準で優先順位を決定：

1. **Critical**: セキュリティ脆弱性、重大なパフォーマンス問題
2. **High**: 設計の不整合、保守性に関わる問題
3. **Medium**: コード品質の改善、軽微な最適化
4. **Low**: スタイル調整、推奨事項

### 3. 結果ファイル生成
レビュー結果を構造化してコンテキストファイル`.tmp/<レビュー対象ファイル>-review.md`（例：`.tmp/login-review.md`）に出力し、実行を促します。

## 出力形式

### レビュー結果サマリー
```
## Login機能 コードレビュー結果

**レビュー実施日**: 2025/11/26
**レビュー対象**: `src/main/python/**/*Login.py` (全5ファイル)

---

## 📄目次

1. [総合評価](#総合評価)
2. [🚨 Critical Issues](#-critical-issues)
    - [C-001: 文字エンコーディングのハードコーディング不一致](#C-001: 文字エンコーディングのハードコーディング不一致)
    - [C-002: XML名前空間置換の脆弱な実装](#C-002: XML名前空間置換の脆弱な実装)
3. [⚠️ High Priority Issues](#-High-Priority-Issues)
4. [📝 Medium Priority Issues](#-Medium-Priority-Issues)
5. [ℹ️ Low Priority Issues](#-Low-Priority-Issues)
6. [追加推奨事項](#追加推奨事項)
7. [関連ドキュメント](#関連ドキュメント)

---

## 総合評価

### 品質スコア

| 分野 | スコア | 評価 |
| -- | -- | -- |
| **コード設計品質** | B（良好） | 設計思想は明確だが一貫性に課題 |
| **パフォーマンス** | C（要改善） | メモリ効率と計算コストに問題 |
| **セキュリティ** | B（良好） | インジェクション対策と入力検証に課題 |

### 問題点サマリー

| 深刻度 | 件数 | 内訳 |
| -- | -- | -- |
| **CRITICAL** | 6件 | 設計:2件、性能4件、セキュリティ:0件 |
| **HIGH** | 6件 | 設計:2件、性能4件、セキュリティ:0件 |
| **MEDIUM** | 8件 | 設計:2件、性能4件、セキュリティ:2件 |
| **LOW** | 6件 | 設計:2件、性能4件、セキュリティ:0件 |

---

## 🚨 Critical Issues

### C-001: 文字エンコーディングのハードコーディング不一致

**分類**: コード設計・保守
**影響**: 文字エンコーディング変更時の修正漏れ、システムエラー

**問題個所**
- `src/main/python/dto/login.py:110`
- `src/main/python/service/login.py:220`

**問題内容**:

Login.pyでは`LoginRequest`で定数`LOGIN_HEADER`を返すが、`pre_login_process`では再度ハードコーディングしている。

\```python
LOGIN_HEADER = "accept: application/json"

def setHeader():
    return { "accept": "application/json" }
\```

**理由**:
文字列リテラルの重複は保守性を低下させる。既に`LOGIN_HEADER`が定義されているため、全箇所で統一するべき。

---

### C-002: XML名前空間置換の脆弱な実装

{{問題点を記載}}

---

## ⚠️ High Priority Issues

### H-001: URIパスパラメータのインジェクション脆弱性

{{問題点を記載}}

---

## 📝 Medium Priority Issues

### M-001: フォームデータURLエンコード時の例外処理不備

{{問題点を記載}}

---

## ℹ️ Low Priority Issues

### L-001: ログ出力における機密情報漏洩リスク

{{問題点を記載}}


---

## 追加推奨事項

### 1. セキュリティテストの実施

- **静的解析ツールの導入**:
    - SpotBugs
    - SonarQube

- **動的解析ツール**:
    - OWASP ZAP
    - Burp Suite

### 2. 入力検証の体系化

---

## 関連ドキュメント

- [パフォーマンス要件](./docs/performance.md)
```

## 注意事項
- レビュー対象を明示的に指定しない場合、コードディレクトリ（src/）全体を対象とします
- 各エージェントは独立して動作し、結果を総合的に評価します
- Critical/Highレベルの問題については、修正の緊急性を強調します
- 出力ファイルには修正案を載せない。変わりに問題点・原因を詳細に記載する。
- 問題点は全て記載。優先順位が低いからと言って省略することは禁止する。
