# コンテキストに対して批判的レビューを実行

## 概要

`.context/` 配下のコンテキストファイルに基づいて、批判的にレビューを行うコマンドです。
専門エージェントを積極的に活用し、コンテキストに記載された要件を批判的にレビューします。

---

## Task
1. コンテキストの読み込み
2. ユーザへの質問事項への回答確認
3. コンテキスト分析
4. 批判的レビュー
5. コンテキスト修正

---

## Phase 1: コンテキストの読み込み

引数で指定されたコンテキストファイルを読み込む：

- 引数が `YYYYMMDDhhmmss.md` 形式の場合 → `.context/YYYYMMDDhhmmss.md` として読み込み
- 引数がフルパスの場合 → そのまま読み込み
- ファイルが存在しない場合 → エラーメッセージを表示して終了

---

## Phase 2: ユーザへの質問事項への回答確認

「ユーザへの確認事項」セクションを確認：
- セクションがない：次のフェーズへ
- 回答していない：処理を中断
- セクションがあり、ユーザが回答している：次のフェーズへ

---

## Phase 3: コンテキスト分析

コンテキストファイルから以下の情報を分析：

1. **実装目的**: 何を実装するのか
2. **対象ファイル**: 実装・修正対象のファイル一覧
3. **参照ドキュメント**: 参照すべき設計書・仕様書
4. **実装方針**: TDD、コーディング規約、テスト方針など
5. **使用するエージェント**: 推奨されるエージェント
6. **終了条件**: 完了判定の条件

---

## Phase 4: 批判的レビュー

コンテキストファイルに対して以下の観点で批判的にレビューを実施する。

### レビュー観点

#### 1. 📝 記述の明確性
- [ ] 曖昧な表現がないか（「できれば」「なるべく」「適切な」など）
- [ ] 具体的な数値・基準が明示されているか
- [ ] 専門用語に説明があるか

#### 2. 📋 情報の完全性
- [ ] 実装目的が明確に記載されているか
- [ ] 対象ファイルが全て列挙されているか（新規/修正の区別）
- [ ] 参照ドキュメントが実際に存在するか
- [ ] テストケースが十分に定義されているか
- [ ] 終了条件が測定可能か

#### 3. 🎯 コンテキストの適切性
- [ ] 目的に直接関係ない情報が含まれていないか
- [ ] 実装コード例が含まれていないか
- [ ] 必要最低限の情報のみに絞られているか

#### 4. 🏗️ 実装方針の妥当性
- [ ] 開発手法（TDD等）が明記されているか
- [ ] コーディング規約が具体的か
- [ ] 外部依存が明示されているか

#### 5. ✅ テストケースの十分性
- [ ] given-when-thenで記述されているか
- [ ] 正常系・異常系が網羅されているか
- [ ] 境界値テストが含まれているか

#### 6. 📚 参照情報の妥当性
- [ ] 参照ドキュメントが存在確認済みか
- [ ] 使用するエージェントが実際に存在するか
- [ ] 関連する過去の議論が参照されているか

### レビュー実施方法

各観点について、以下のエージェントを活用してレビューを実施：

1. **document-explorer**: 参照ドキュメントの存在確認と内容確認
2. **code-explorer**: 既存コードとの整合性確認
3. **note-explorer**: 過去の議論・決定事項との整合性確認

---

## Phase 5: コンテキスト修正

レビュー結果に基づいて、問題点をユーザに提示し、修正を実施する。

### 修正フロー

1. **問題点の提示**:
   ```markdown
   ## 🔍 レビュー結果

   以下の問題点が見つかりました：

   ### ❌ 重大な問題（修正必須）
   1. [問題点の説明]
   2. [問題点の説明]

   ### ⚠️ 改善推奨
   1. [改善提案]
   2. [改善提案]
   ```

2. **修正案の提示**:
   - 各問題点に対して具体的な修正案を提示
   - ユーザに修正内容の確認を取る

3. **修正の実施**:
   - ユーザの承認後、コンテキストファイルを修正
   - 修正後、再度レビュー観点をチェック

4. **最終確認**:
   ```markdown
   ## ✅ 修正完了確認

   以下の基準を全て満たしていることを確認：
   - [ ] 曖昧な表現が除去されている
   - [ ] 実装コード例が含まれていない
   - [ ] 必須セクションが全て記載されている
   - [ ] 参照ドキュメントが実際に存在する
   - [ ] 終了条件が明確で測定可能
   - [ ] テストケースが十分に定義されている

   コンテキストレビューが完了しました。
   ```

---

## 注意事項

### 批判的レビュー 【MUST】
- **遠慮しない**: 問題点は明確に指摘する
- **建設的**: 批判だけでなく改善案を提示
- **具体的**: 「曖昧」ではなく「どこがどう曖昧か」を明示

### エージェント活用 【MUST】
- **document-explorer**: 参照ドキュメントの確認に必ず使用
- **code-explorer**: 既存コードの確認に必ず使用
- **note-explorer**: 過去の議論確認に必ず使用

### 品質基準 【MUST】
- **必要最低限の情報**: 目的からずれた情報は記載しない
- **コード例の禁止**: 実装例ではなく、要件・方針を記載
- **曖昧さの排除**: 「できれば」「なるべく」等の表現禁止
- **具体的な数値**: 「適切な」ではなく「120文字以内」のように明示

### 対話的修正 【MUST】
- **ユーザ確認**: 修正前に必ずユーザに確認を取る
- **段階的修正**: 一度に全て修正せず、問題点を提示してから修正
- **理由説明**: なぜその修正が必要かを説明する 